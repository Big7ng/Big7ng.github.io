<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title>  · Big7ng's Blog</title><meta name="description" content=" - Big7ng"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="https://big7ng.github.io/atom.xml" title="Big7ng's Blog"><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="Big7ng's Blog" type="application/atom+xml">
</head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="https://github.com/Big7ng" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title"></h1><div class="post-info">Sep 24, 2023</div><div class="post-content"><h2 id="编译内核"><a href="#编译内核" class="headerlink" title="编译内核"></a>编译内核</h2><p>安装所需工具</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install -y build-essential gcc-riscv64-linux-gnu libncurses-dev</span><br></pre></td></tr></table></figure>

<p>下载源码</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/starfive-tech/linux.git</span><br><span class="line"><span class="comment"># 执行以下命令，切换到代码分支：</span></span><br><span class="line"><span class="built_in">cd</span> linux</span><br><span class="line">git checkout -b JH7110_VisionFive2_devel origin/JH7110_VisionFive2_devel</span><br><span class="line">git pull</span><br></pre></td></tr></table></figure>

<p>设置编译Linux内核的默认设置</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make starfive_visionfive2_defconfig CROSS_COMPILE=riscv64-linux-gnu- ARCH=riscv</span><br></pre></td></tr></table></figure>

<p>设置编译Linux内核其他软件设置</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make CROSS_COMPILE=riscv64-linux-gnu- ARCH=riscv menuconfig</span><br></pre></td></tr></table></figure>

<p>编译内核</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make CROSS_COMPILE=riscv64-linux-gnu- ARCH=riscv -j4</span><br></pre></td></tr></table></figure>

<p>生成vmlinux</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make CROSS_COMPILE=riscv64-linux-gnu- ARCH=riscv INSTALL_PATH=~/repos/compiled/ zinstall -j4</span><br></pre></td></tr></table></figure>

<h2 id="安装内核"><a href="#安装内核" class="headerlink" title="安装内核"></a>安装内核</h2><h3 id="手动安装"><a href="#手动安装" class="headerlink" title="手动安装"></a>手动安装</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">mkdir</span> /boot/dtbs/new</span><br><span class="line">sudo <span class="built_in">mkdir</span> /boot/dtbs/new/starfive</span><br><span class="line">sudo <span class="built_in">cp</span> <span class="built_in">arch</span>/riscv/boot/dts/starfive/jh7110-visionfive-v2*.dtb /boot/dtbs/new/starfive/</span><br><span class="line">sudo <span class="built_in">cp</span> -r <span class="built_in">arch</span>/riscv/boot/dts/starfive/vf2-overlay /boot/dtbs/new/starfive/</span><br><span class="line">sudo <span class="built_in">cp</span> ~/repos/compiled/vmlinuz-5.15.0_new /boot/boot/vmlinuz-5.15.0_for_HonestQiao</span><br></pre></td></tr></table></figure>

<p>更新&#x2F;boot&#x2F;extlinux&#x2F;extlinux.conf文件</p>
<h3 id="自动安装"><a href="#自动安装" class="headerlink" title="自动安装"></a>自动安装</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo make install </span><br><span class="line">sudo make modules_install</span><br></pre></td></tr></table></figure>

</div></article></div></main><footer><div class="paginator"><a href="/2023/11/05/samba/" class="prev">PREV</a><a href="/2023/09/11/glinet/" class="next">NEXT</a></div><div class="copyright"><p>© 2022 - 2023 <a href="https://big7ng.github.io">Big7ng</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script></body></html>